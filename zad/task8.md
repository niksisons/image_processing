# Стратегия тестирования

Применимые виды тестирования:

* Модульное (unit) — разработчики, покрытие критических библиотек и утилит.
* Интеграционное — взаимодействие CI → реестр образов → Helm/манифесты → Kubernetes API.
* Системное — end-to-end пайплайны от commit до рабочего Pod.
* Регрессионное — автоматизированные тесты пайплайнов и манифестов.
* Нефункциональное: нагрузочное, стресс, стабильности, безопасность (SAST/DAST), юзабилити, совместимость.
* Контроль конфигураций и инфраструктуры.

Инструменты:

* GitLab CI/CD — встроенные пайплайны, self-hosted опция, интеграция с реестром.
* Docker / Buildkit / Kaniko — сборка образов в CI.
* Helm / Kustomize — декларативный деплой в Kubernetes.
* Prometheus + Grafana — метрики, SLO/alerting.
* Loki / ELK — логирование для расследований.
* Trivy/Snyk/Clair — сканирование уязвимостей образов.
* JMeter / k6 — нагрузочное тестирование.
* Terraform / Ansible / Kubespray — инфраструктурный тестинг и репродуцируемость.

Роли и ресурсы:

* Тест-менеджер — стратегия, метрики, приемка.
* QA-инженеры (2) — функциональные и регрессионные тесты.
* SRE / DevOps (2) — тестовые окружения, мониторинг, откат.
* Разработчики — unit/integration тесты, исправление дефектов.
* Инфраструктурный инженер — настройка тестовых кластов и CI-раннеров.
  Ресурсы: тестовый Kubernetes-кластер (минимум 3 ноды для HA-симуляции), GitLab self-hosted CI, приватный реестр (Harbor/Registry), тестовая база данных, средства генерации трафика.

Критерии завершения тестирования:

* Функциональное покрытие >= 95% для критических сценариев.
* Нет открытых критических дефектов (Severity = Critical).
* Все автоматические пайплайны проходят в тестовом окружении не менее 3 подряд прогонов.
* Нефункциональные: latency(задержка) p95 < целевого значения; throughput соответствует SLA; устойчивость при 2x ожидаемой нагрузки.
* Документированы и воспроизведены все найденные дефекты и тестовые наборы в системе трекинга.

Метрики качества тестирования:

* Покрытие требований (Traceability %).
* Скорость прохождения тест-кейсов (функц. / нефункц.).
* Среднее время обнаружения (MTTD) дефекта.
* Среднее время для исправления (MTTR).
* Количество регрессий на выпуск.

Процесс регистрации дефектов:

* Инструмент: GitLab Issues.
* Обязательные поля: шаги воспроизведения, среда (k8s версиия, образ), логи, severity, воспроизводимость.
* SLA на обработку: Critical — 24 ч, High — 72 ч, Medium — 7 дн.
* Схема сортировки: ежедневные стендапы для Critical/High.

# Функциональные тест-кейсы (18).

| ID                  | Title                                                             | Priority | Preconditions                                      | Steps                                                                           | Expected result                                                            | Requirement(s) |
| ------------------- | ----------------------------------------------------------------- | -------- | -------------------------------------------------- | ------------------------------------------------------------------------------- | -------------------------------------------------------------------------- | -------------- |
| TC-AUTH-001         | Успешная авторизация в веб-интерфейсе GitLab                      | Critical | Создан user; доступ к UI                           | 1. Открыть `/signin` <br>2. Ввести валидные учётные данные <br>3. Нажать Submit | Вход успешен; пользователь видит dashboard                                 | AUTH-01        |
| TC-AUTH-002         | Отказ при неверном пароле                                         | High     | Существующий user                                  | Ввести корректный логин + неверный пароль и Submit                              | Ошибка авторизации, сообщение об ошибке, без блокировки                    | AUTH-01        |
| TC-CI-001           | Запуск pipeline при push в ветку main                             | Critical | Репозиторий с `.gitlab-ci.yml`, настроенный runner | Сделать push в `main`                                                           | Pipeline запускается, стадии build → test → deploy выполняются             | CI-01          |
| TC-BUILD-001        | Успешная сборка docker-образа                                     | Critical | Корректный Dockerfile, настроенный runner          | Запустить stage build                                                           | Образ собран, запушен в registry; hash = артефакт                          | BUILD-01       |
| TC-SCAN-001         | Сканирование образа на уязвимости выявляет критическую уязвимость | High     | Тестовый образ с уязвимостью                       | Запустить security-scan stage                                                   | Скан сообщает об уязвимости; pipeline помечен как failed/warning по policy | SEC-01         |
| TC-DEPLOY-001       | Деплой в namespace staging                                        | Critical | Helm chart / manifest доступен                     | Вызвать stage deploy для staging                                                | Deployment создан; Pods в Ready; Service доступен                          | DEP-01         |
| TC-ROLLBACK-001     | Автоматический rollback при failed readiness                      | High     | Деплой настроен с readiness / liveness             | Задеплоить багнутый образ                                                       | Health-check падает; система откатывает на предыдущую стабильную версию    | DEP-02         |
| TC-SMOKE-001        | Smoke-проверка после деплоя                                       | High     | Деплой завершён                                    | Выполнить набор smoke запросов (health, basic API)                              | Все ответы 200 OK; latency в пределах SLA                                  | QA-01          |
| TC-SERVICE-MESH-001 | Взаимодействие сервисов через internal service                    | High     | Два микросервиса задеплоены                        | Сделать запрос к сервису A → вызывает B                                         | Корректный ответ; trace / лог содержит вызов B                             | INT-01         |
| TC-SECRET-001       | Доступ к секретам через K8s Secret                                | Critical | Секрет создан в k8s                                | Деплой приложения, читающего секрет из env                                      | Приложение читает секрет; секрет не раскрыт в логах                        | SEC-02         |
| TC-NAMESPACES-001   | Изоляция namespace (RBAC)                                         | High     | Два namespace, роль ограничена                     | Попытаться получить ресурс другого namespace через serviceaccount               | Доступ запрещён (HTTP 403 / k8s RBAC error)                                | AUTH-02        |
| TC-CANARY-001       | Canary-деплой 10% трафика                                         | Medium   | Canary strategy настроена                          | Провести canary deploy, направить 10% трафика                                   | ~10% запросов уходят к новой версии; метрики отражают распределение        | DEP-03         |
| TC-LOGGING-001      | Логи приложений попадают в централизованную систему               | Medium   | Promtail / agent настроен                          | Сгенерировать лог через приложение; проверить лог в Loki/ELK                    | Лог найден, метаданные корректны (timestamp, service, level)               | MON-01         |
| TC-METRICS-001      | Экспорт пользовательских метрик в Prometheus                      | Medium   | Экспортер метрик настроен                          | Сгенерировать нагрузку, затем проверить p95/p99 метрики                         | Метрики видны в Prometheus; графики Grafana обновляются                    | MON-02         |
| TC-HELM-001         | Применение override через `values.yaml`                           | Medium   | Chart поддерживает values override                 | Выполнить `helm upgrade --values custom.yaml`                                   | Параметры применены; приложение работает с новыми настройками              | OPS-01         |
| TC-DB-CONN-001      | Подключение приложения к тестовой БД                              | Critical | БД доступна; секреты заданы                        | Выполнить запись и чтение через приложение                                      | Операции успешны; транзакция откатывается/коммитится корректно             | INT-02         |
| TC-CLEANUP-001      | Удаление ресурсов при destroy pipeline                            | Low      | Есть test namespace                                | Запустить cleanup stage                                                         | Ресурсы удалены; namespace очищен                                          | OPS-02         |
| TC-AUDIT-001        | Аудит действий пользователей (who/when/what)                      | High     | Audit-логирование включено                         | Выполнить изменение конфигурации; просмотреть audit logs                        | Запись есть: user, timestamp, action, resource, details                    | SEC-03         |

# Нефункциональные тест-кейсы (6)

| ID               | Title                                                 | Priority | Preconditions                                    | Steps                                                         | Expected result                                                                 |
| ---------------- | ----------------------------------------------------- | -------- | ------------------------------------------------ | ------------------------------------------------------------- | ------------------------------------------------------------------------------- |
| NF-LOAD-001      | Нагрузочное тестирование API-endpoint                 | Critical | Test-среда масштабирована                        | Смоделировать нагрузку: обычную + 2× ожидаемую — 30 минут     | p95 latency < SLA; error rate < 1%; кластер не падает                           |
| NF-STRESS-001    | Стресс-тест + восстановление после пиков              | High     | Система под мониторингом                         | Деградировать нагрузку до отказа → затем снизить              | Система деградирует корректно; данные не теряются; восстановление автоматически |
| NF-STABILITY-001 | Soak-тест стабильности (24–72 часа)                   | High     | Приложение развернуто, нагрузка = низкий/средний | Запуск теста на 24–72 часа                                    | Нет утечек памяти; error rate < threshold; среднее CPU/память — стабильно       |
| NF-SEC-001       | Аудит безопасности (SAST + DAST + config scan)        | Critical | Исходники и образы доступны                      | Запустить SAST/DAST + security-scan образа и конфигурации     | Нет критических уязвимостей; если есть — оформлен план mitigation               |
| NF-USAB-001      | Юзабилити интерфейса CI/CD для оператора              | Medium   | UI CI/CD доступен                                | Оператор: запускает pipeline, вводит vars, просматривает логи | Все операции выполняются в целевое время; навигация без ошибок; UI понятен      |
| NF-COMPAT-001    | Совместимость с обновлением Kubernetes (upgrade test) | High     | Тест-кластер доступен                            | Обновить minor версию k8s → прогнать deploy + smoke           | Система работает; манифесты совместимы; инструкции обновлены                    |


# Приоритеты и группировка

Тесты сгруппированы по модулям:

Авторизация / RBAC — TC-AUTH-001, TC-AUTH-002, TC-NAMESPACES-001

CI/CD & build / registry — TC-CI-001, TC-BUILD-001, TC-SCAN-001, TC-HELM-001, NF-SEC-001

Деплой / оркестрация (Kubernetes / Helm / Canary / rollback) — TC-DEPLOY-001, TC-ROLLBACK-001, TC-CANARY-001, TC-CLEANUP-001, NF-COMPAT-001

Smoke / интеграция сервисов / DB / secrets / mesh — TC-SMOKE-001, TC-SERVICE-MESH-001, TC-SECRET-001, TC-DB-CONN-001, NF-LOAD/NF-STRESS/NF-STABILITY

Мониторинг / логирование / observability — TC-LOGGING-001, TC-METRICS-001, TC-AUDIT-001

Нефункциональные: performance / stability / security / usability / compatibility — NF-LOAD-001 .. NF-COMPAT-001

# Матрица трассируемости

| Requirement                                                 | Linked Test Cases                                             |
| ----------------------------------------------------------- | ------------------------------------------------------------- |
| R-AUTH (авторизация / RBAC)                                 | TC-AUTH-001, TC-AUTH-002, TC-NAMESPACES-001                   |
| R-CI / R-BUILD (CI/CD, сборка, registry)                    | TC-CI-001, TC-BUILD-001, TC-HELM-001                          |
| R-SEC (безопасность, сканы, secrets, аудит)                 | TC-SCAN-001, TC-SECRET-001, TC-AUDIT-001, NF-SEC-001          |
| R-DEP (деплой, rollback, deploy flow)                       | TC-DEPLOY-001, TC-ROLLBACK-001, TC-CANARY-001, TC-CLEANUP-001 |
| R-MON (мониторинг / логирование / метрики)                  | TC-LOGGING-001, TC-METRICS-001                                |
| R-INT / R-OPS (интеграция, межсервисное взаимодействие, DB) | TC-SERVICE-MESH-001, TC-DB-CONN-001                           |
| R-PERF (нагрузка, стабильность)                             | NF-LOAD-001, NF-STRESS-001, NF-STABILITY-001                  |
| R-USAB (юзабилити, удобство)                                | NF-USAB-001                                                   |
| R-COMPAT (совместимость, обновления)                        | NF-COMPAT-001                                                 |
| QA / Smoke (прочие проверки)                                | TC-SMOKE-001                                                  |


Выявление требований без покрытия:

* Если в SRS есть требования про multi-region DR, backup retention и т.д. — добавить отдельные NF/OPS тесты.

# Целевые показатели покрытия и качества

* Покрытие требований: критические — 100%, высокие — >= 95%, остальные >= 80%.
* Unit-тесты: coverage модулей критической логики >= 80%.
* Regression pass rate: >= 98% при стабильной ветке.
* SLA по uptime тестовой среды: 99.5% в период тестирования.
* Время выполнения полного regression suite: целевое < 2 часа (при параллелизации).

# План тестирования (последовательность, сроки, ответственные)

Фазы:

1. Подготовка среды (2–4 дня) — SRE/DevOps

   * Поднять тестовый кластер, GitLab, runner, реестр, monitoring.
2. Unit & Integration (параллельно) (1–2 недели) — Разработчики + QA

   * Unit тесты, mock-интеграции.
3. Build & Security (2–3 дня) — QA + DevOps

   * Проверка сборки, сканирование образов.
4. System E2E (3–7 дней) — QA

   * Полные пайплайны, деплой, smoke.
5. Нефункциональные тесты (нагрузка/стабильность) (1–2 недели) — QA + SRE
6. UAT / OAT (3–5 дней) — Заказчик/операторы
7. Final regression и sign-off (2–3 дня) — Тест-менеджер

Ответственные:

* QA lead — координация сценариев.
* DevOps — поддержка среды и автоматизации.
* Devs — фиксы и unit tests.
* Product owner — UAT sign-off.

Процедура дефект-менеджмента:

* Создать проблема → сортировка → назначение → исправление → code review → пересборка → регрессионный цикл → закрытие.
* При регрессии: откат(rollback) и быстрое исправление(hotfix pipeline).