# 1. Диаграмма вариантов использования (Use Case)
[![](https://img.plantuml.biz/plantuml/svg/VLJRQjj047qNw1-6l0SQsx6J4aoWVUzJFq3OIocuJh3a42W59UdbeOM-55fAQPe_K9oeLdpJByp-KSwCravaEyRWdTapStpciZuCew0NzTzrV2zeHKSzud-SyD36-BxccJstNpZZqHnzQKvU7OUBs4kUyTX-uo7E0IVsd5Fn5_WVt4yvm_qCZ1di6z_plPvfHK7tJSSGNm4zqxm99_JUzuZweMa5eQ4j_etq2JuW81x1kULaYuAGNh_OAKTUgTWOGGbnHaAej1dkL9h8uDGbLyh9Vn6OQyM3Wc36r-eEnHaGxBJWix5Zg9OPVY0Wvp4IxoIXRKvSNAqSznEakRsmPpmYQOSMVYE_PJ_3bsPDxLVxwQ40Y7TKksMgIwriWgelf3i3EkuTjLreVQEwHu6DrKQCP8mEtjkWFeTpfxHoJXU3sL-Yn62cEe8nLEWG20IfZNKw7sMvT74U2jrvjgPIv4nq7ME2aOeXgJ9i21WxmaSaImlo2mHvULkT6XrzfktvNqYqt-SaM9GFih3h7mLjRpUBLTo8Onh5it7-_f8lzQvxANDO-9zuQFEGYeZ4wVmAFQU3WxVTLgVVDiscG1K7LLUXgeDggr3DGRjFGtM5p6bakkq2gJkaiPhKSD3UKfBl7SB2lz0z)](https://editor.plantuml.com/uml/VLJRQjj047qNw1-6l0SQsx6J4aoWVUzJFq3OIocuJh3a42W59UdbeOM-55fAQPe_K9oeLdpJByp-KSwCravaEyRWdTapStpciZuCew0NzTzrV2zeHKSzud-SyD36-BxccJstNpZZqHnzQKvU7OUBs4kUyTX-uo7E0IVsd5Fn5_WVt4yvm_qCZ1di6z_plPvfHK7tJSSGNm4zqxm99_JUzuZweMa5eQ4j_etq2JuW81x1kULaYuAGNh_OAKTUgTWOGGbnHaAej1dkL9h8uDGbLyh9Vn6OQyM3Wc36r-eEnHaGxBJWix5Zg9OPVY0Wvp4IxoIXRKvSNAqSznEakRsmPpmYQOSMVYE_PJ_3bsPDxLVxwQ40Y7TKksMgIwriWgelf3i3EkuTjLreVQEwHu6DrKQCP8mEtjkWFeTpfxHoJXU3sL-Yn62cEe8nLEWG20IfZNKw7sMvT74U2jrvjgPIv4nq7ME2aOeXgJ9i21WxmaSaImlo2mHvULkT6XrzfktvNqYqt-SaM9GFih3h7mLjRpUBLTo8Onh5it7-_f8lzQvxANDO-9zuQFEGYeZ4wVmAFQU3WxVTLgVVDiscG1K7LLUXgeDggr3DGRjFGtM5p6bakkq2gJkaiPhKSD3UKfBl7SB2lz0z)

Commit code — разработчик пушит изменения в репозиторий; запускается pipeline. (см. GitLab + Runner в диаграмме).
Build & Test — CI собирает образ, выполняет тесты, собирает артефакты.
Push image to Registry — загрузка образа в self-hosted registry (GitLab Registry / Harbor).
Deploy to Dev — GitLab Runner / Agent разворачивает Helm-чарты в Dev-кластере (через GitOps/helm).
Run Integration Tests — автоматические интеграционные/smoke-тесты после деплоя.
Promote to Prod — ручная/авт. промоция образа и чарта в Prod-окружение (включает approval).
Deploy to Prod — деплой в Prod (nginx/HAProxy, Rook/Ceph для storage, Postgres).
Rollback — откат релиза при ошибках (расширяет Deploy).
Trigger Pipeline / Manage CI/CD — администратор настраивает пайплайны, runner'ы, dependency proxy.
View Metrics & Alerts — просмотр метрик Prometheus/Grafana и оповещений; интеграция с Alertmanager.

# 2. Диаграмма классов (Class Diagram)

[![](https://mermaid.ink/img/pako:eNqdVctu2kAU_ZXRrGgKURxKHl50Q6Q-U2XdOIvBnhir9hgNdtU0QspL6iKtUnUZVVW77oaSuiGQgJQvGP9R74yxDQRSqUKCmfs85z6GfWz6FsU6Nl3SbG44xObEMxhC6o7EdxGJoRiIS9GNj8QgPhBdcSXOQfJbtNG-tEToYTPgDrNRyN2ZHvHZpJ3oiAh0PdEeyau-5znB9g4C2UBcwwd849ORFpxsm_Itp0Fdh9HCAx2lZ2nRMlgOOFVMQ3Os7E54IEO89TOZSZhJ3SmhTYOXvt2U0iTGnVzVZ8_92j2JEq5dcZ3xv_1JWejd9lF8CPzbwPE4PhzpeMhkLlW_y_hY9OOPic2dvMokkiGguN_EL_huQ7kHojOjISNBI2zWC45HbAopMh_IV_P93MZ1Z9rkl7tYzkUfQEo6UXzwIqxRzmhAm9NIJsrwCkYOmg0kL4Fm2maLNlx_r2DWoUE6ekpdryqPMv-X-FQMZa1EL62W77o1Yr4piE6um7QcIzcBOYt8L8bxUT2AcPkQb5IGAuA3QPsDNOJmTNUARFA-1cfP4CaLcgJ1683q4lfI14OyDiA65IBM3fjwPzFtqNp5lAUIFlMuYB_m4QoWCQAmyaW_SVxagFSJAaQXXR05LJicgzolblCv1imUVzL5MTmr0ywGqgTp43AjLjIOW9z3aFCnIdgNJVNxPdI84WSXMILEhZyr-CRdROgqNYNNCkRNtXoQP1JzLsG2t3fGAPzjbTKwZmDkl0pwWoBT8sYgHXZPWciS_5GeMlb2bCReC7mX2nFdNrydDhacosQt0ZZKj-_bSV02TLpDK5PM4kotTAcWIJrKr2LN2ynAnpTiAj6RelmPJvqtyjLPOyc1Z_R0uZFDhbwDe3mWgptjLqHmuwQsQaj6AS-XesFS93mAFNdZ8wNAPkFCFU1tURe-VTwkJzqbh67BcBHb3LGwHvCQFrFHuUfkFasZNDBMn0cNrMPRorskdAMDG6wFbg3CXvu-l3pyP7TrWN8lbhNuYcMiAR39HWZSTplFedUPWYD18vKyCoL1ffwO69ra0mKlUtHK61p5RVt_tLJaxHtYrywvrqyuadq6VimXtVYRv1c5lxbXVitFTC0n8Pnm6B9Y_rT-AiQPjCw?type=png)](https://mermaid.live/edit#pako:eNqdVctu2kAU_ZXRrGgKURxKHl50Q6Q-U2XdOIvBnhir9hgNdtU0QspL6iKtUnUZVVW77oaSuiGQgJQvGP9R74yxDQRSqUKCmfs85z6GfWz6FsU6Nl3SbG44xObEMxhC6o7EdxGJoRiIS9GNj8QgPhBdcSXOQfJbtNG-tEToYTPgDrNRyN2ZHvHZpJ3oiAh0PdEeyau-5znB9g4C2UBcwwd849ORFpxsm_Itp0Fdh9HCAx2lZ2nRMlgOOFVMQ3Os7E54IEO89TOZSZhJ3SmhTYOXvt2U0iTGnVzVZ8_92j2JEq5dcZ3xv_1JWejd9lF8CPzbwPE4PhzpeMhkLlW_y_hY9OOPic2dvMokkiGguN_EL_huQ7kHojOjISNBI2zWC45HbAopMh_IV_P93MZ1Z9rkl7tYzkUfQEo6UXzwIqxRzmhAm9NIJsrwCkYOmg0kL4Fm2maLNlx_r2DWoUE6ekpdryqPMv-X-FQMZa1EL62W77o1Yr4piE6um7QcIzcBOYt8L8bxUT2AcPkQb5IGAuA3QPsDNOJmTNUARFA-1cfP4CaLcgJ1683q4lfI14OyDiA65IBM3fjwPzFtqNp5lAUIFlMuYB_m4QoWCQAmyaW_SVxagFSJAaQXXR05LJicgzolblCv1imUVzL5MTmr0ywGqgTp43AjLjIOW9z3aFCnIdgNJVNxPdI84WSXMILEhZyr-CRdROgqNYNNCkRNtXoQP1JzLsG2t3fGAPzjbTKwZmDkl0pwWoBT8sYgHXZPWciS_5GeMlb2bCReC7mX2nFdNrydDhacosQt0ZZKj-_bSV02TLpDK5PM4kotTAcWIJrKr2LN2ynAnpTiAj6RelmPJvqtyjLPOyc1Z_R0uZFDhbwDe3mWgptjLqHmuwQsQaj6AS-XesFS93mAFNdZ8wNAPkFCFU1tURe-VTwkJzqbh67BcBHb3LGwHvCQFrFHuUfkFasZNDBMn0cNrMPRorskdAMDG6wFbg3CXvu-l3pyP7TrWN8lbhNuYcMiAR39HWZSTplFedUPWYD18vKyCoL1ffwO69ra0mKlUtHK61p5RVt_tLJaxHtYrywvrqyuadq6VimXtVYRv1c5lxbXVitFTC0n8Pnm6B9Y_rT-AiQPjCw)

Атрибуты и методы даны с типами и модификаторами (публичные +). Комментарии:
GitRepository — репрезентирует исходный код и триггеры CI.
Pipeline / CIJob — модели CI/CD, взаимосвязанные и управляющие сборкой/деплоем.
ImageRegistry — GitLab Registry / Harbor.
KubernetesCluster/HelmChart/Microservice — описывают деплой-стек, масштабирование и здоровье.
Monitoring — Prometheus/Grafana, метрики и визуализация.
Группировка по функционалу:
Интеграция разработки: GitRepository, Pipeline, CIJob.
Деплой/оркестрация: ImageRegistry, HelmChart, KubernetesCluster, Microservice.
Наблюдаемость: Monitoring, Metric.

# 3. Диаграмма компонентов (Component Diagram)

[![](https://mermaid.ink/img/pako:eNqVVV1P01AY_isn50rjxDndB7swISPBRYiAcmPHRecO2yJrl34kKiEBDBrUhGC4QgJy4X1RJuNj5S-8_Uc-53TdBtmkZul63q_n_XrarvDXZkXwPK9aerPGXk6WDMZstxyKdBisUYtOcXWCDfKCj9QOtqULY1N1Z1ovLxS18MAWiouhgX6QR6cI9OiY_GAj-ERtOqe2NsoQxe2RTx1qQd0JviDlIeSL4CvS-_QLyTegu5A4IwwKRxiVknG9ie9w-61SebSD-6nKsk5emLfQa6FQZA_YvGsYwlocbHKiKgwnclJC1_xULDdoX04H1wn9AeyaJpXspraP97xp0wFdSaUq3UdIqGY39d2golG1hG1rRdupm6iQvgWbaOkE-D6dMfTly_UgDmPBr58uHOl1E-2iqiuc_WBbG-bAgNzzGDXTXRjXEfcBjnuQPBQjt3bZ40BLzlgia4MCQ55jRQG1vKjOHaXw-kDBpjZr2g4afzE3HXkdIPQzsM4xHtl7i34qqA6Wiv0HW9TS5k3zDWZUEM1aLwyMaikin4A0RwiUNWypBbXpTJvXy-W6MzMX-R8Bal2R6hLg-4qV7XAj8O-AS542a5kN4dSEa7N7bMrSl3RDvz6rUWxn9-8_6T080jE6K0NBqQqhMDi4AfUw1knzMH2IcwsN-lUocseOuc1HAT1zy8IyhCPsidmidgd_A6q7i7FxhnEkfnAM6vwH2L8JpYBikChkQsgdrXuPXqPxComRRIJ1XyAx98oT-BjUKzzvWK5I8IawGroU-YrEKnGwviFKPI9jRSzp7rJT4iVjFWFN3Xhlmo0o0jLdao3nl_RlG5LbrOiOmKzreIP0XfC4CKtguobD86lMUmHw_Ap_y_Pjj8fS6fTDR9lkKpVLZzMJ_g7K5Fgmm0vmsrlMOpUdz6VWE_y9ypkcy2XTCS4qdce0ZsKPmvq2rf4FKOXDug?type=png)](https://mermaid.live/edit#pako:eNqVVV1P01AY_isn50rjxDndB7swISPBRYiAcmPHRecO2yJrl34kKiEBDBrUhGC4QgJy4X1RJuNj5S-8_Uc-53TdBtmkZul63q_n_XrarvDXZkXwPK9aerPGXk6WDMZstxyKdBisUYtOcXWCDfKCj9QOtqULY1N1Z1ovLxS18MAWiouhgX6QR6cI9OiY_GAj-ERtOqe2NsoQxe2RTx1qQd0JviDlIeSL4CvS-_QLyTegu5A4IwwKRxiVknG9ie9w-61SebSD-6nKsk5emLfQa6FQZA_YvGsYwlocbHKiKgwnclJC1_xULDdoX04H1wn9AeyaJpXspraP97xp0wFdSaUq3UdIqGY39d2golG1hG1rRdupm6iQvgWbaOkE-D6dMfTly_UgDmPBr58uHOl1E-2iqiuc_WBbG-bAgNzzGDXTXRjXEfcBjnuQPBQjt3bZ40BLzlgia4MCQ55jRQG1vKjOHaXw-kDBpjZr2g4afzE3HXkdIPQzsM4xHtl7i34qqA6Wiv0HW9TS5k3zDWZUEM1aLwyMaikin4A0RwiUNWypBbXpTJvXy-W6MzMX-R8Bal2R6hLg-4qV7XAj8O-AS542a5kN4dSEa7N7bMrSl3RDvz6rUWxn9-8_6T080jE6K0NBqQqhMDi4AfUw1knzMH2IcwsN-lUocseOuc1HAT1zy8IyhCPsidmidgd_A6q7i7FxhnEkfnAM6vwH2L8JpYBikChkQsgdrXuPXqPxComRRIJ1XyAx98oT-BjUKzzvWK5I8IawGroU-YrEKnGwviFKPI9jRSzp7rJT4iVjFWFN3Xhlmo0o0jLdao3nl_RlG5LbrOiOmKzreIP0XfC4CKtguobD86lMUmHw_Ap_y_Pjj8fS6fTDR9lkKpVLZzMJ_g7K5Fgmm0vmsrlMOpUdz6VWE_y9ypkcy2XTCS4qdce0ZsKPmvq2rf4FKOXDug)

Интерфейсы / зависимости:
GitLab UI ↔ CI: REST / Webhooks — триггер pipeline и просмотр статусов.
CI → Registry: Docker Registry API (push/pull).
HelmManager → Kubernetes API: Helm charts устанавливаются через k8s API.
GitLabAgent ↔ GitLab Platform: двунаправленная связь для GitOps/runner management.
MonitoringSystem (Prometheus) ← Kubernetes: сбор метрик; Grafana визуализирует.
Компоненты по уровням: presentation (GitLab UI, Developers, Users), business logic (CI, Agent, HelmManager, Ingress), data access (Registry, DB, ObjectStorage, MessageBus, Monitoring).

# 4. State Diagram (диаграмма состояний) — объект: Release / Pipeline Job
[![](https://mermaid.ink/img/pako:eNqFk81O20AQx19lNcfKiSITJ44PvcC1L0Ddg1UvIRK2kbGr0ihSkn4hcWhV9UyF-gIh4NYJ2HmF2Tfq7DgBQ1NVlj92Zv6_2ZnxDuF15Etw4CTxErk38PqxFzTemG4oxMtnr0Sj8VzgBf7CHG9whgW9M-17aqsCL_EKSzXGJc6EI_A3eVfqvZrgUuCKFgt63vK7wBlj6gpG_KD4MyIWeK0RK_JOSJMJ5qwwI2-BJS4ELTfanFl1KbO-Y8YJdfQjFu_qjFLiXBAgI-pETdWYMXUVY76Re4y5-kBs2qf6RN9fGKjNeEfxBd-6D-ozRYzVdF3fdi1jv-KSwnKca63GZby7vOKW2l4VtzEsqN0Uqs7_R77gNlxtxvBvblH14m94nbBGTjnLlIC6U-S9potIgrq69q1rfojdXud9fH2m5GPx42gG_NTD0V0l05w39nScc3WuPlIRN3qkBddY0u7KarhUu_4VGb-NpZPQv-6GYEA_HvjgJHEqDQhkHHh6CUOtdSE5lIF0waFPXx546VHighuOSHbshftRFGyUcZT2D8E58I5OaJUe-w9n694ay9CX8W6Uhgk4vRYzwBnCW3BMu920LKvVsUyz29uxewacgrPT7HTtVtekZ7tntzsda2TAO87aatpdywDpD5IoflEdaD7Xoz9zXyRN?type=png)](https://mermaid.live/edit#pako:eNqFk81O20AQx19lNcfKiSITJ44PvcC1L0Ddg1UvIRK2kbGr0ihSkn4hcWhV9UyF-gIh4NYJ2HmF2Tfq7DgBQ1NVlj92Zv6_2ZnxDuF15Etw4CTxErk38PqxFzTemG4oxMtnr0Sj8VzgBf7CHG9whgW9M-17aqsCL_EKSzXGJc6EI_A3eVfqvZrgUuCKFgt63vK7wBlj6gpG_KD4MyIWeK0RK_JOSJMJ5qwwI2-BJS4ELTfanFl1KbO-Y8YJdfQjFu_qjFLiXBAgI-pETdWYMXUVY76Re4y5-kBs2qf6RN9fGKjNeEfxBd-6D-ozRYzVdF3fdi1jv-KSwnKca63GZby7vOKW2l4VtzEsqN0Uqs7_R77gNlxtxvBvblH14m94nbBGTjnLlIC6U-S9potIgrq69q1rfojdXud9fH2m5GPx42gG_NTD0V0l05w39nScc3WuPlIRN3qkBddY0u7KarhUu_4VGb-NpZPQv-6GYEA_HvjgJHEqDQhkHHh6CUOtdSE5lIF0waFPXx546VHighuOSHbshftRFGyUcZT2D8E58I5OaJUe-w9n694ay9CX8W6Uhgk4vRYzwBnCW3BMu920LKvVsUyz29uxewacgrPT7HTtVtekZ7tntzsda2TAO87aatpdywDpD5IoflEdaD7Xoz9zXyRN)

Состояния и события:
Pending — ожидает запуска.
Building — сборка образов (CIJob).
Pushing — пуш в registry (GitLab Registry / Harbor).
Deploying — применение Helm chart в k8s.
Verifying — smoke/integration tests, health checks.
Active — рабочая версия в кластере.
Failed / Rollback — обработка ошибок и откат релиза.

## Обоснование архитектуры

Выбранная архитектура разделяет ответственность по слоям: разработка/репозиторий и триггеры (presentation), CI/CD и операторы (business logic), и хранилища/очереди/базы (data access). Такой подход соответствует best-practice для self-hosted enterprise: GitLab self-managed обеспечивает полный контроль за реестром образов и пайплайнами, GitLab Agent/Runner управляют безопасным деплоем в кластеры, а Helm/Operator-паттерн гарантирует декларативность и воспроизводимость развертываний. Это снижает человеческий фактор и упрощает аудит и rollback — важные критерии при выборе on-prem / bare-metal.

Наличие Prometheus/Grafana и Elastic/RabbitMQ обеспечивает наблюдаемость и асинхронную обработку задач (background workers), что повышает устойчивость системы при нагрузке и позволяет оперативно реагировать на сбои. Хранение артефактов в локальном registry (GitLab/Harbor) и объектном хранилище Rook/Ceph обеспечивает высокую доступность и контроль над данными, что важно при on-prem развертывании и требованиях безопасности.