# 1. Диаграмма вариантов использования (Use Case)
[![](https://img.plantuml.biz/plantuml/svg/VLJRQjj047qNw1-6l0SQsx6J4aoWVUzJFq3OIocuJh3a42W59UdbeOM-55fAQPe_K9oeLdpJByp-KSwCravaEyRWdTapStpciZuCew0NzTzrV2zeHKSzud-SyD36-BxccJstNpZZqHnzQKvU7OUBs4kUyTX-uo7E0IVsd5Fn5_WVt4yvm_qCZ1di6z_plPvfHK7tJSSGNm4zqxm99_JUzuZweMa5eQ4j_etq2JuW81x1kULaYuAGNh_OAKTUgTWOGGbnHaAej1dkL9h8uDGbLyh9Vn6OQyM3Wc36r-eEnHaGxBJWix5Zg9OPVY0Wvp4IxoIXRKvSNAqSznEakRsmPpmYQOSMVYE_PJ_3bsPDxLVxwQ40Y7TKksMgIwriWgelf3i3EkuTjLreVQEwHu6DrKQCP8mEtjkWFeTpfxHoJXU3sL-Yn62cEe8nLEWG20IfZNKw7sMvT74U2jrvjgPIv4nq7ME2aOeXgJ9i21WxmaSaImlo2mHvULkT6XrzfktvNqYqt-SaM9GFih3h7mLjRpUBLTo8Onh5it7-_f8lzQvxANDO-9zuQFEGYeZ4wVmAFQU3WxVTLgVVDiscG1K7LLUXgeDggr3DGRjFGtM5p6bakkq2gJkaiPhKSD3UKfBl7SB2lz0z)](https://editor.plantuml.com/uml/VLJRQjj047qNw1-6l0SQsx6J4aoWVUzJFq3OIocuJh3a42W59UdbeOM-55fAQPe_K9oeLdpJByp-KSwCravaEyRWdTapStpciZuCew0NzTzrV2zeHKSzud-SyD36-BxccJstNpZZqHnzQKvU7OUBs4kUyTX-uo7E0IVsd5Fn5_WVt4yvm_qCZ1di6z_plPvfHK7tJSSGNm4zqxm99_JUzuZweMa5eQ4j_etq2JuW81x1kULaYuAGNh_OAKTUgTWOGGbnHaAej1dkL9h8uDGbLyh9Vn6OQyM3Wc36r-eEnHaGxBJWix5Zg9OPVY0Wvp4IxoIXRKvSNAqSznEakRsmPpmYQOSMVYE_PJ_3bsPDxLVxwQ40Y7TKksMgIwriWgelf3i3EkuTjLreVQEwHu6DrKQCP8mEtjkWFeTpfxHoJXU3sL-Yn62cEe8nLEWG20IfZNKw7sMvT74U2jrvjgPIv4nq7ME2aOeXgJ9i21WxmaSaImlo2mHvULkT6XrzfktvNqYqt-SaM9GFih3h7mLjRpUBLTo8Onh5it7-_f8lzQvxANDO-9zuQFEGYeZ4wVmAFQU3WxVTLgVVDiscG1K7LLUXgeDggr3DGRjFGtM5p6bakkq2gJkaiPhKSD3UKfBl7SB2lz0z)

Commit code — разработчик пушит изменения в репозиторий; запускается pipeline. (см. GitLab + Runner в диаграмме).

Build & Test — CI собирает образ, выполняет тесты, собирает артефакты.

Push image to Registry — загрузка образа в self-hosted registry (GitLab Registry / Harbor).

Deploy to Dev — GitLab Runner / Agent разворачивает Helm-чарты в Dev-кластере (через GitOps/helm).

Run Integration Tests — автоматические интеграционные/smoke-тесты после деплоя.

Promote to Prod — ручная/авт. промоция образа и чарта в Prod-окружение (включает approval).

Deploy to Prod — деплой в Prod (nginx/HAProxy, Rook/Ceph для storage, Postgres).

Rollback — откат релиза при ошибках (расширяет Deploy).

Trigger Pipeline / Manage CI/CD — администратор настраивает пайплайны, runner'ы, dependency proxy.

View Metrics & Alerts — просмотр метрик Prometheus/Grafana и оповещений; интеграция с Alertmanager.

# 2. Диаграмма классов (Class Diagram)

[![](https://mermaid.ink/img/pako:eNqVV1tT2zgU_isaz3SH7YZAgBLqKZmBhO2mBcpAuw87eZHtE0etLHkkOduU4b_vkWQ7voSWfbHlo3P5zlXyYxDLBIIwiDnVesZoqmi2EIS8ekXOz8_JTGaUiZD8DUozKchUCqMkJ7-R6fxgOrM8lttJk_fM3EMuNTNSbcij3SDkjwejmEhJoXibkMCSFtxcKiriVbl1zbR5N5VZxsyExO6tyy0USlNQdywHzgTsRU4uJF7b7yQk1ZYVeNqi8uq6cPSKtgm0MCup2rQMtKYplMQZNfCZZUAMPrShWd6xVAGobV1LVMKStlIFS_w6OCDeAyIVMTTtoDPUFNoywTAdkrur29n89v2A3H-5vXWLhy_T6dXDw4D8eTG_vpq1wjf_IKMJ-SqjKnSoTZk9G6K1rNHEaBx4l5qCuZapdmSPpRtNq_3nDgqaQc-dFHZ52I2sQwrJheluLJlgetXYKdVwmd5RU5WPKoRDjhDvQWNxdcBfKMOWNDb_F3--NeEkNPsBlxsDPfxFziVNKphoeUcr2RbCBShsontIMWXYLK0-msn4G6h5hkHrlm0fW692EpZidb4Ibl5sY9oIk7NcQ3u2j620Y91jWRo2UdscRFJuGTn3jBZ-VVgDC73Zvw0Fz0dvBhjiTQbCkAMyF0tFEWQRm0JBO4gfiwiUAPR6ygttMNy_DCXN2ZVIcsmEaTbULU7ICRH4rAKYOBB7CjhQjQ7d-4Vzosa3rUBbmZLziMbfdspUoWqk4C_g2XSFzfBr1Gs_mkviDc3flfH9FH2FGOfomvLCQ28YKM2_uBO2gGL7rCqpUaks6zU5iDWph1gC64GbBC73uZLJSyaCD3Wj8cvYd0qsjm8nnjsq6FOkQa1pxDgzGyyiGynsgWUhtApoS3_YYP1kP8mEK5MbQHo8wUPDvitHYgSGWfCbfq42uTtZ8dQXJ2Umi4iDT3A___41IZxGwPujNlY039H8FxzUcwOyhOc97AxiWAN3yf6XKuFSHCtmWEx7xz5aZrnZlmxjyKtds1-Blnzdn_0V_XLTT_aF1jJm1FrBY9RWu1-vWK6rNLevK4tgtAjI6_19XL3GVXltCPEa4ua1fk5E1iL1-R-SFXX8NaWn3R2jIYHvEBflZPa0rtL6zApdzxRxk3l_f9I6LbD2C8YTx9Ge4l21bSmN_ni91Vzw_H39hX6ObzshQnu3Q6_LzPQncRdMpQzjJrW_8fWFrI1eT4Yk86TKWI-ja6usYZtX15nOWkls8h4Oh_bDtwOaoZvP_ga6EMEgSBVLghBPHhgEGSicLPgZuK5ZBGYF2KJBiMvykrsIFuIJxXIq_pEyqySVLNJVEC4p1_hV5AmWfHkHr6kKRAJqKgthgvD45NgpCcLH4HsQHo2G47Px-PTo9O3xaDw6G58Ngk0Q7r8ZnpyMR6cnJ8eH4_ER0p8GwQ9ndzQ8PDpE3vHR6ej47embM9QHiY3YTfkfYF9P_wGsseKb?type=png)](https://mermaid.live/edit#pako:eNqVV1tT2zgU_isaz3SH7YZAgBLqKZmBhO2mBcpAuw87eZHtE0etLHkkOduU4b_vkWQ7voSWfbHlo3P5zlXyYxDLBIIwiDnVesZoqmi2EIS8ekXOz8_JTGaUiZD8DUozKchUCqMkJ7-R6fxgOrM8lttJk_fM3EMuNTNSbcij3SDkjwejmEhJoXibkMCSFtxcKiriVbl1zbR5N5VZxsyExO6tyy0USlNQdywHzgTsRU4uJF7b7yQk1ZYVeNqi8uq6cPSKtgm0MCup2rQMtKYplMQZNfCZZUAMPrShWd6xVAGobV1LVMKStlIFS_w6OCDeAyIVMTTtoDPUFNoywTAdkrur29n89v2A3H-5vXWLhy_T6dXDw4D8eTG_vpq1wjf_IKMJ-SqjKnSoTZk9G6K1rNHEaBx4l5qCuZapdmSPpRtNq_3nDgqaQc-dFHZ52I2sQwrJheluLJlgetXYKdVwmd5RU5WPKoRDjhDvQWNxdcBfKMOWNDb_F3--NeEkNPsBlxsDPfxFziVNKphoeUcr2RbCBShsontIMWXYLK0-msn4G6h5hkHrlm0fW692EpZidb4Ibl5sY9oIk7NcQ3u2j620Y91jWRo2UdscRFJuGTn3jBZ-VVgDC73Zvw0Fz0dvBhjiTQbCkAMyF0tFEWQRm0JBO4gfiwiUAPR6ygttMNy_DCXN2ZVIcsmEaTbULU7ICRH4rAKYOBB7CjhQjQ7d-4Vzosa3rUBbmZLziMbfdspUoWqk4C_g2XSFzfBr1Gs_mkviDc3flfH9FH2FGOfomvLCQ28YKM2_uBO2gGL7rCqpUaks6zU5iDWph1gC64GbBC73uZLJSyaCD3Wj8cvYd0qsjm8nnjsq6FOkQa1pxDgzGyyiGynsgWUhtApoS3_YYP1kP8mEK5MbQHo8wUPDvitHYgSGWfCbfq42uTtZ8dQXJ2Umi4iDT3A___41IZxGwPujNlY039H8FxzUcwOyhOc97AxiWAN3yf6XKuFSHCtmWEx7xz5aZrnZlmxjyKtds1-Blnzdn_0V_XLTT_aF1jJm1FrBY9RWu1-vWK6rNLevK4tgtAjI6_19XL3GVXltCPEa4ua1fk5E1iL1-R-SFXX8NaWn3R2jIYHvEBflZPa0rtL6zApdzxRxk3l_f9I6LbD2C8YTx9Ge4l21bSmN_ni91Vzw_H39hX6ObzshQnu3Q6_LzPQncRdMpQzjJrW_8fWFrI1eT4Yk86TKWI-ja6usYZtX15nOWkls8h4Oh_bDtwOaoZvP_ga6EMEgSBVLghBPHhgEGSicLPgZuK5ZBGYF2KJBiMvykrsIFuIJxXIq_pEyqySVLNJVEC4p1_hV5AmWfHkHr6kKRAJqKgthgvD45NgpCcLH4HsQHo2G47Px-PTo9O3xaDw6G58Ngk0Q7r8ZnpyMR6cnJ8eH4_ER0p8GwQ9ndzQ8PDpE3vHR6ej47embM9QHiY3YTfkfYF9P_wGsseKb)

Атрибуты и методы даны с типами и модификаторами (публичные +). Комментарии:

GitRepository — репрезентирует исходный код и триггеры CI.

Pipeline / CIJob — модели CI/CD, взаимосвязанные и управляющие сборкой/деплоем.

ImageRegistry — GitLab Registry / Harbor.

KubernetesCluster/HelmChart/Microservice — описывают деплой-стек, масштабирование и здоровье.

Monitoring — Prometheus/Grafana, метрики и визуализация.

Группировка по функционалу:

Интеграция разработки: GitRepository, Pipeline, CIJob.

Деплой/оркестрация: ImageRegistry, HelmChart, KubernetesCluster, Microservice.

Наблюдаемость: Monitoring, Metric.

# 3. Диаграмма компонентов (Component Diagram)

[![](https://mermaid.ink/img/pako:eNp9VEuP2jAQ_iuWT63KUsLy2ORQiU2qbdRFvMqlCQeHDCHdxI5spypF_PdOXgS2u9zmm2_eM_aRbkUI1KKRZNme_HB8TojKgwrOJSjgmulY8IIg5CnWzyxYu14lkLW7qQgHfkMiMpDKa8Wa-8rDtSoYFEgplQTw0OdX-R5zFXNQ6llE8bbytc-pbJd8Jsucc5Cby2ImEZbYGJWgpr9Bkk4ZZxFIr5BJDVrvWaZmWCfTQnoVJA2ujVwe4QyU5yqcAeavMbEF11IkyTmaA1kiDilmbymvVb52-L93h2k22W4xeBVwCVGstDx4bopFn2GTDq0DpsCbC6WxpNXimTiPNTkLfsFWr7AL9PSWQrxg5TZk-5qfYhJkFjnkSLMgiPV00XCCx-gY82il2fbFm0uRgt5Drsgn8iTZDmd43UG7bnJ39-V8IQXVyCVhlyq7Ak07F6qLdRXaC1jSbw24zVHu_abdW_rS4XsegOSgQU3mrvehhQTxx81N32YNN42u1nHT8nIxheGrZVTzrXZQPMFKat7g-1GvoxS2zRm_PzDawS8hDqmlZQ4dmoJMWQHpsfD3KZ5ECj61UAxhx_JE-9TnJ3TLGP8pRNp4SpFHe2rtWKIQ5VnINDgxw6NvTfCWQNoi55pa_cGwjEGtI_1DLdPomv3BqD8YmL1-b2SMOvRAraHRHY3MoTEcGwPTNMejU4f-LZP2ug_joYGW9-ZDz-j1h_cdCmHR_7T66Mr_7vQP0bKw2Q?type=png)](https://mermaid.live/edit#pako:eNp9VEuP2jAQ_iuWT63KUsLy2ORQiU2qbdRFvMqlCQeHDCHdxI5spypF_PdOXgS2u9zmm2_eM_aRbkUI1KKRZNme_HB8TojKgwrOJSjgmulY8IIg5CnWzyxYu14lkLW7qQgHfkMiMpDKa8Wa-8rDtSoYFEgplQTw0OdX-R5zFXNQ6llE8bbytc-pbJd8Jsucc5Cby2ImEZbYGJWgpr9Bkk4ZZxFIr5BJDVrvWaZmWCfTQnoVJA2ujVwe4QyU5yqcAeavMbEF11IkyTmaA1kiDilmbymvVb52-L93h2k22W4xeBVwCVGstDx4bopFn2GTDq0DpsCbC6WxpNXimTiPNTkLfsFWr7AL9PSWQrxg5TZk-5qfYhJkFjnkSLMgiPV00XCCx-gY82il2fbFm0uRgt5Drsgn8iTZDmd43UG7bnJ39-V8IQXVyCVhlyq7Ak07F6qLdRXaC1jSbw24zVHu_abdW_rS4XsegOSgQU3mrvehhQTxx81N32YNN42u1nHT8nIxheGrZVTzrXZQPMFKat7g-1GvoxS2zRm_PzDawS8hDqmlZQ4dmoJMWQHpsfD3KZ5ECj61UAxhx_JE-9TnJ3TLGP8pRNp4SpFHe2rtWKIQ5VnINDgxw6NvTfCWQNoi55pa_cGwjEGtI_1DLdPomv3BqD8YmL1-b2SMOvRAraHRHY3MoTEcGwPTNMejU4f-LZP2ug_joYGW9-ZDz-j1h_cdCmHR_7T66Mr_7vQP0bKw2Q)

Интерфейсы / зависимости:

GitLab UI ↔ CI: REST / Webhooks — триггер pipeline и просмотр статусов.

CI → Registry: Docker Registry API (push/pull).

HelmManager → Kubernetes API: Helm charts устанавливаются через k8s API.

GitLabAgent ↔ GitLab Platform: двунаправленная связь для GitOps/runner management.

MonitoringSystem (Prometheus) ← Kubernetes: сбор метрик; Grafana визуализирует.

Компоненты по уровням: presentation (GitLab UI, Developers, Users), business logic (CI, Agent, HelmManager, Ingress), data access (Registry, DB, ObjectStorage, MessageBus, Monitoring).

# 4. State Diagram (диаграмма состояний) — объект: Release / Pipeline Job
[![](https://mermaid.ink/img/pako:eNpVkj1v2zAQQP8KcWNhG5ZkUQqHAGmDbgWKDB1adWDEs0SEIgV-JE0M__eSkiw7G3n33pFH3glaIxAYOM89PkreWT5sX_NGE_Lny1-y3d6Tn6iF1F0KLcsp_DVINW0YMZqMckQlNZJYyPrErvmpRnD9yj6nDHGhbdG5qeySTeQjjsq8r6wceIdkjMCtcIWS8gutPF4Vi84EG1HCx1FJFMm4Msl4aL18xYi_9ahJj1z5nrQ9ti-OjHw-47PxnUuF4mIs6DEGE7okE_dklHrm7ct8lYHrwBUxlvDgDfFWdh3apKzcp-vYS_Sm1yW5vI3FNn6UmMtrfIvdKuQOiZieZG72hkta_MhGwwY6KwUwbwNuYEA78LSFUzIa8D0O2ACLS4FHHpRvoNHnqI1c_zZmuJjWhK4HduTKxV0YxXVwViSOCdpvJmgP7JCXUw1gJ_gHLD-Uu6quqiyv6vKO3tXFBt6BZXRXlnld7CmtaF7R7HDewMd0bLbb5_siq2hV0LrIKI31UEhv7I95dqcRPv8HTmvo1Q?type=png)](https://mermaid.live/edit#pako:eNpVkj1v2zAQQP8KcWNhG5ZkUQqHAGmDbgWKDB1adWDEs0SEIgV-JE0M__eSkiw7G3n33pFH3glaIxAYOM89PkreWT5sX_NGE_Lny1-y3d6Tn6iF1F0KLcsp_DVINW0YMZqMckQlNZJYyPrErvmpRnD9yj6nDHGhbdG5qeySTeQjjsq8r6wceIdkjMCtcIWS8gutPF4Vi84EG1HCx1FJFMm4Msl4aL18xYi_9ahJj1z5nrQ9ti-OjHw-47PxnUuF4mIs6DEGE7okE_dklHrm7ct8lYHrwBUxlvDgDfFWdh3apKzcp-vYS_Sm1yW5vI3FNn6UmMtrfIvdKuQOiZieZG72hkta_MhGwwY6KwUwbwNuYEA78LSFUzIa8D0O2ACLS4FHHpRvoNHnqI1c_zZmuJjWhK4HduTKxV0YxXVwViSOCdpvJmgP7JCXUw1gJ_gHLD-Uu6quqiyv6vKO3tXFBt6BZXRXlnld7CmtaF7R7HDewMd0bLbb5_siq2hV0LrIKI31UEhv7I95dqcRPv8HTmvo1Q)

Состояния и события:

Pending — ожидает запуска.

Building — сборка образов (CIJob).

Pushing — пуш в registry (GitLab Registry / Harbor).

Deploying — применение Helm chart в k8s.

Verifying — smoke/integration tests, health checks.

Active — рабочая версия в кластере.

Failed / Rollback — обработка ошибок и откат релиза.

## Обоснование архитектуры

Выбранная архитектура разделяет ответственность по слоям: разработка/репозиторий и триггеры (presentation), CI/CD и операторы (business logic), и хранилища/очереди/базы (data access). Такой подход соответствует best-practice для self-hosted enterprise: GitLab self-managed обеспечивает полный контроль за реестром образов и пайплайнами, GitLab Agent/Runner управляют безопасным деплоем в кластеры, а Helm/Operator-паттерн гарантирует декларативность и воспроизводимость развертываний. Это снижает человеческий фактор и упрощает аудит и rollback — важные критерии при выборе on-prem / bare-metal.

Наличие Prometheus/Grafana и Elastic/RabbitMQ обеспечивает наблюдаемость и асинхронную обработку задач (background workers), что повышает устойчивость системы при нагрузке и позволяет оперативно реагировать на сбои. Хранение артефактов в локальном registry (GitLab/Harbor) и объектном хранилище Rook/Ceph обеспечивает высокую доступность и контроль над данными, что важно при on-prem развертывании и требованиях безопасности.